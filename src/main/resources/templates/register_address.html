<!doctype HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>連絡先登録</title>
	<link href="/css/reset.css" th:href="@{/css/reset.css}" rel="stylesheet" />
	<link href="/css/style.css" th:href="@{/css/style.css}" rel="stylesheet" />
</head>

<body>
	<header th:insert="fragments/page_header::commonHeader"></header>

<main>
<div class="form">
	<h2 class="title">連絡先登録</h2>
	
	<table id="company" class="register_address">
		<tr>
			<th class="companyInformation">会社情報</th>
			<td class="staffform">
				<div class="companyname">※会社名</div>
				<div class="companyaddress">所在地</div>
				<input type="text" name="companyName" maxlength="32" />
				<input class="textarea" type="text" name="companyAddress" maxlength="32" />
			</td>
		</tr>
		<tr>
			<th>担当者情報</th>
			<td class="staffform">
				<div class="staffname">※担当者名</div>
				<div class="mailaddress">※メールアドレス</div>
				<div class="phonenumber">電話番号</div>
				<input type="text" name="staffName" placeholder="" maxlength="16" />
				<input class="mailarea" type="email" name="mailAddress"  maxlength="32" />
				<input class="phonearea" type="tel" name="phoneNumber"  maxlength="16" />
				<input type="text" name="staffName" placeholder="" maxlength="16" />
				<input class="mailarea" type="email" name="mailAddress"  maxlength="32" />
				<input class="phonearea" type="tel" name="phoneNumber"  maxlength="16" />
				<input type="text" name="staffName" placeholder="" maxlength="16" />
				<input class="mailarea" type="email" name="mailAddress"  maxlength="32" />
				<input class="phonearea" type="tel" name="phoneNumber"  maxlength="16" />
				<input type="text" name="staffName" placeholder="" maxlength="16" />
				<input class="mailarea" type="email" name="mailAddress"  maxlength="32" />
				<input class="phonearea" type="tel" name="phoneNumber"  maxlength="16" />
				<input type="text" name="staffName" placeholder="" maxlength="16" />
				<input class="mailarea" type="email" name="mailAddress"  maxlength="32" />
				<input class="phonearea" type="tel" name="phoneNumber"  maxlength="16" />
				<input type="text" name="staffName" placeholder="" maxlength="16" />
				<input class="mailarea" type="email" name="mailAddress"  maxlength="32" />
				<input class="phonearea" type="tel" name="phoneNumber"  maxlength="16" />
				<input type="text" name="staffName" placeholder="" maxlength="16" />
				<input class="mailarea" type="email" name="mailAddress"  maxlength="32" />
				<input class="phonearea" type="tel" name="phoneNumber"  maxlength="16" />
				<input type="text" name="staffName" placeholder="" maxlength="16" />
				<input class="mailarea" type="email" name="mailAddress"  maxlength="32" />
				<input class="phonearea" type="tel" name="phoneNumber"  maxlength="16" />
				<input type="text" name="staffName" placeholder="" maxlength="16" />
				<input class="mailarea" type="email" name="mailAddress"  maxlength="32" />
				<input class="phonearea" type="tel" name="phoneNumber"  maxlength="16" />
				<input type="text" name="staffName" placeholder="" maxlength="16" />
				<input class="mailarea" type="email" name="mailAddress"  maxlength="32" />
				<input class="phonearea" type="tel" name="phoneNumber"  maxlength="16" />
							
			</td>
		<tr>

		<tr>
			<th class="buttonArea">
				<span class="info hidden">登録が完了しました。</span>
			</th>
			<th class="buttonArea">
				<button id="confirm" >確認</button>
			</th>
			
	</table>
		<div class="chofukukakunin">
			<button id="checkCompanyName">重複確認</button>
			<span id="checkOK" class="hidden">OK</span>
		</div>
	
</div>

<!-- Modal Dialog (会社名重複) -->
<div th:insert="fragments/dialog_duplicated_company_name::dialogDuplicatedCompanyName"></div>

<!-- Modal Dialog (会社情報入力エラー) -->
<div th:insert="fragments/dialog_input_company_error::dialogInputCompanyError"></div>

<!-- Modal Dialog (入力内容確認) -->
<div th:insert="fragments/dialog_input_company_confirm::dialogInputCompanyConfirm"></div>

</main>

<script>
// dialog_input_company_error.htmlのエラーメッセージを表示するdivのクラスを定義
const companyerrorSelector = {
	'会社名': '.companyNameError',
	'担当者': '.staffNameError',
	'メールアドレス': '.mailAddressError',
	'所在地': '.companyAddressError',
	'電話番号': '.phoneNumberError',
};

$(() => {
	
	// jQuery-UIダイアログの初期設定
	$('#duplicatedCompanyName').dialog(companydialogConfig.duplicatedCompanyName);
	$('#inputCompanyError').dialog(companydialogConfig.inputCompanyError);
	$('#inputCompanyConfirm').dialog(companydialogConfig.inputCompanyConfirm);
	
	$('button#checkCompanyName').on('click', () => {
		let companyName = $('table#company input[name=companyName]');
		if (isEmpty($(companyName).val())) return;
		checkCompanyName(companyName);
	});
	
	$('button#confirm').on('click', () => {
	// 入力チェック処理(companyvalidator.js:validate(checkerConfig))を呼び出す
	// 引数はcompanyvalidator.js:checkerからチェックしたい項目の変数の宣言を作成する
		let errInfo = validate({
			'companyName': companychecker.companyName,
			'staffName': companychecker.staffName,
			'mailAddress': companychecker.mailAddress,
			'companyAddress': companychecker.companyAddress,
			'phoneNumber': companychecker.phoneNumber,

		});
		if (companyerrInfo.isError) {
			// エラーがあればエラーダイアログを表示する(companyvalidator.js:createErrorDialog(companycheckerConfig))
			createErrorDialog(companyerrInfo.companyerrMsg);
			$("#inputCompanyError").dialog("open");
		} else {
			// エラーがなければ、確認ダイアログを表示する(companydialogConfig.js:createConfirmDialog(companycheckerConfig))
			createConfirmDialog({
				'companyName': companychecker.companyName,
				'staffName': companychecker.staffName,
				'mailAddress': companychecker.mailAddress,
				'companyAddress': companychecker.companyAddress,
				'phoneNumber': companychecker.phoneNumber,
	
			});
			$("#inputCompanyConfirm").dialog("open");
		}
	});
});

	function checkCompanyName(companyName) {
		let companyerrInfo = validate({ 'companyName': checker.companyName });
		if (companyerrInfo.isError) {
				createErrorDialog(companyerrInfo.errMsg);
				$("#inputCompanyError").dialog("open");
				return;
			}
	
		$.ajax({
			type: 'POST',
			url: '/mailsystem/register_address/duplicatedCompanyName',
			data: companyName,
			scriptCharset: 'utf-8'
		})
		.then((result) => {
			if (result) {	// 重複あり
				$('button#confirm').prop('disabled', true);
				$("#duplicatedCompanyName").dialog("open");
				//$('button#checkCompanyName').prop('class', '');
				$('span#checkOK').prop('class', 'hidden');
			} else {			// 重複なし
				$('button#confirm').prop('disabled', false);
				//$('button#checkCompanyName').prop('class', 'hidden');
				$('span#checkOK').prop('class', 'info');
			}
		}, () => {
			alert('Error: ajax connection failed.');
		});
	
}

</script>

</body>

</html>
